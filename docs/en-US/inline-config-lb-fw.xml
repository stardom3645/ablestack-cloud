<?xml version='1.0' encoding='utf-8' ?>
<!DOCTYPE section PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN" "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
<!ENTITY % BOOK_ENTITIES SYSTEM "cloudstack.ent">
%BOOK_ENTITIES;
]>
<!-- Licensed to the Apache Software Foundation (ASF) under one
  or more contributor license agreements.  See the NOTICE file
  distributed with this work for additional information
  regarding copyright ownership.  The ASF licenses this file
  to you under the Apache License, Version 2.0 (the
  "License"); you may not use this file except in compliance
  with the License.  You may obtain a copy of the License at
  http://www.apache.org/licenses/LICENSE-2.0
  Unless required by applicable law or agreed to in writing,
  software distributed under the License is distributed on an
  "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
  KIND, either express or implied.  See the License for the
  specific language governing permissions and limitations
  under the License.
-->
<section id="inline-config-lb-fw">
  <title>Configuring Network Devices in Inline and Side by Side Modes</title>
  <para>The external network elements, such as load balancer and firewall devices, supported in
    &PRODUCT; can be deployed in either of the following modes: Side by Side and Inline. Inline mode
    was originally supported in &PRODUCT; 2.2.x versions, and is now added back in the 3.0.6
    release.</para>
  <para>In Inline mode, one firewall device is placed in front of a load balancing device. The
    firewall acts as the gateway for all incoming traffic, then redirect the load balancing traffic
    to the load balancer behind it. The load balancer in this case will not have the direct access
    to the public network. Deploying network devices in Inline mode ensures that the resources are
    protected.</para>
  <mediaobject>
    <imageobject>
      <imagedata fileref="./images/parallel-inline-mode.png"/>
    </imageobject>
    <textobject>
      <phrase>parallel-inline-mode.png: external networks in different deployment modes</phrase>
    </textobject>
  </mediaobject>
  <para>In Side by Side mode, a firewall device is deployed in parallel with the load balancer
    device. So the traffic to the load balancer public IP is not routed through the firewall, and
    therefore, is exposed to the public network. </para>
  <mediaobject>
    <imageobject>
      <imagedata fileref="./images/parallel-mode.png"/>
    </imageobject>
    <textobject>
      <phrase>parallel-mode.png: adding a firewall and load balancer in side by side mode</phrase>
    </textobject>
  </mediaobject>
  <para>The following table gives you an overview of the supported services and devices for inline
    and side by side mode.</para>
  <informaltable>
    <tgroup cols="4" align="left" colsep="1" rowsep="1">
      <colspec colwidth="1.08*" colname="c1" colnum="1"/>
      <colspec colwidth="1.2*" colname="c2" colnum="2"/>
      <colspec colnum="3" colname="c3" colwidth="1.0*"/>
      <colspec colnum="4" colname="c4" colwidth="5.15*"/>
      <thead>
        <row>
          <entry><para>Mode</para></entry>
          <entry><para>Firewall</para></entry>
          <entry><para>Load Balancer</para></entry>
          <entry><para>Supported</para></entry>
        </row>
      </thead>
      <tbody>
        <row>
          <entry><para>Side by Side</para></entry>
          <entry><para>Virtual Router</para></entry>
          <entry><para>F5</para></entry>
          <entry><para>Yes</para></entry>
        </row>
        <row>
          <entry><para>Side by Side</para></entry>
          <entry><para>Virtual Router</para></entry>
          <entry><para>Virtual Router</para></entry>
          <entry><para>Yes</para></entry>
        </row>
        <row>
          <entry><para>Side by Side</para></entry>
          <entry><para>Virtual Router</para></entry>
          <entry><para>NetScaler</para></entry>
          <entry><para>Yes</para></entry>
        </row>
        <row>
          <entry><para>Side by Side</para></entry>
          <entry><para>Juniper SRX</para></entry>
          <entry><para>F5</para></entry>
          <entry><para>Yes</para></entry>
        </row>
        <row>
          <entry><para>Side by Side</para></entry>
          <entry><para>Juniper SRX</para></entry>
          <entry><para>NetScaler</para></entry>
          <entry><para>Yes</para></entry>
        </row>
        <row>
          <entry><para>Inline</para></entry>
          <entry><para>Virtual Router</para></entry>
          <entry><para>F5</para></entry>
          <entry><para>No</para></entry>
        </row>
        <row>
          <entry><para>Inline</para></entry>
          <entry><para>Virtual Router</para></entry>
          <entry><para>NetScaler</para></entry>
          <entry><para>No</para></entry>
        </row>
        <row>
          <entry><para>Inline</para></entry>
          <entry><para>Juniper SRX</para></entry>
          <entry><para>F5</para></entry>
          <entry><para>Yes</para></entry>
        </row>
        <row>
          <entry><para>Inline</para></entry>
          <entry><para>Juniper SRX</para></entry>
          <entry><para>NetScaler</para></entry>
          <entry><para>No</para></entry>
        </row>
        <row>
          <entry><para>Inline</para></entry>
          <entry><para>Juniper SRX</para></entry>
          <entry><para>Virtual Router</para></entry>
          <entry><para>No</para></entry>
        </row>
      </tbody>
    </tgroup>
  </informaltable>
  <para>To configure SRX and F5 in Inline mode:</para>
  <orderedlist>
    <listitem>
      <para>Configure F5 Big IP and Juniper SRX.</para>
      <para>See the respective product documentation for more information.</para>
    </listitem>
    <listitem>
      <para>Add SRX and F5 to the same zone in &PRODUCT;.</para>
      <note>
        <para>Ensure that you select per zone sourceNAT when creating the network offering. When
          adding F5 BigIP, do not make it a dedicated device.</para>
      </note>
    </listitem>
    <listitem>
      <para>Enable both the devices.</para>
    </listitem>
    <listitem>
      <para>Create a network offering:</para>
      <para>Use SRX as provider for Firewall, Port Forwarding, SourceNAT, and StaticNat. Select F5
        BigIP as the service provider for Load Balancing. Use Virtual Router as the service provider
        for DNS, DHCP, user data.</para>
    </listitem>
    <listitem>
      <para>Select Inline mode.</para>
      <para>For more information, see <phrase condition="admin"><xref
            linkend="creating-network-offerings"/>.</phrase>
        <phrase condition="install">Creating Network Offerings in the Administration Guide.</phrase>
      </para>
    </listitem>
    <listitem>
      <para>Start a new VM with this new network offering.</para>
    </listitem>
    <listitem>
      <para>Add firewall and load balancing rules. For more information, see <phrase
          condition="admin"><xref linkend="add-load-balancer-rule"/></phrase>
        <phrase condition="install">Adding a Load Balancer Rule</phrase> and <phrase
          condition="admin"><xref linkend="firewall-rules"/>.</phrase>
        <phrase condition="install">IP Forwarding and Firewalling in the Administration
          Guide.</phrase>
      </para>
    </listitem>
  </orderedlist>
</section>
