<?xml version='1.0' encoding='utf-8' ?>
<!DOCTYPE section PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN" "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
<!ENTITY % BOOK_ENTITIES SYSTEM "cloudstack.ent">
%BOOK_ENTITIES;
]>

<!-- Licensed to the Apache Software Foundation (ASF) under one
	or more contributor license agreements.  See the NOTICE file
	distributed with this work for additional information
	regarding copyright ownership.  The ASF licenses this file
	to you under the Apache License, Version 2.0 (the
	"License"); you may not use this file except in compliance
	with the License.  You may obtain a copy of the License at
	
	http://www.apache.org/licenses/LICENSE-2.0
	
	Unless required by applicable law or agreed to in writing,
	software distributed under the License is distributed on an
	"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
	KIND, either express or implied.  See the License for the
	specific language governing permissions and limitations
	under the License.
-->
<section id="changing-service-offering-for-vm">
	<title>Changing the Service Offering for a VM</title>
		<para>To upgrade or downgrade the level of compute resources available to a virtual machine, you can change the VM's compute offering.</para>
		<orderedlist>
			<listitem><para>Log in to the &PRODUCT; UI as a user or admin.</para></listitem>
			<listitem><para>In the left navigation, click Instances.</para></listitem>
			<listitem><para>Choose the VM that you want to work with.</para></listitem>
			<listitem><para>(Skip this step if you have enabled dynamic VM scaling; see <xref linkend="change-cpu-ram-for-vm"/>.)</para>
				<para>Click the Stop button to stop the VM.<inlinemediaobject>
					<imageobject>
						<imagedata fileref="./images/stop-instance-icon.png"/>
					</imageobject>
					<textobject>
						<phrase>StopButton.png: button to stop a VM</phrase>
					</textobject>
				</inlinemediaobject>
				</para></listitem>
			<listitem><para>Click the Change Service button.<inlinemediaobject>
					<imageobject>
						<imagedata fileref="./images/change-service-icon.png"/>
					</imageobject>
					<textobject>
						<phrase>ChangeServiceButton.png: button to change the service of a
							VM</phrase>
					</textobject>
				</inlinemediaobject></para>
				<para>The Change service dialog box is displayed.</para></listitem>
			<listitem><para>Select the offering you want to apply to the selected VM.</para></listitem>
			<listitem><para>Click OK.</para></listitem>
		</orderedlist>
	<section id="change-cpu-ram-for-vm">
		<!-- CLOUDSTACK-658 -->
		<title>CPU and Memory Scaling for Running VMs</title>
		<para>(Supported on VMware and XenServer)</para>
		<para>It is not always possible to accurately predict the CPU and RAM requirements
			when you first deploy a VM.
			You might need to increase or decrease these resources at any time during the life of a VM.
			You can dynamically modify CPU and RAM levels to
			change these resources for a running VM without incurring any downtime.</para>
		<para>Dynamic CPU and RAM scaling can be used in the following cases:</para>
		<itemizedlist>
			<listitem><para>New VMs that are created
				after the installation of &PRODUCT; 4.2.
				If you are upgrading from a previous version of &PRODUCT;,
				your existing VMs created with previous versions
				will not have the dynamic scaling capability.</para>
			</listitem>
			<listitem><para>User VMs on hosts running VMware and XenServer.</para></listitem>
			<listitem><para>System VMs on VMware.</para></listitem>
			<listitem><para>VM Tools or XenServer Tools must be installed on the virtual machine.</para></listitem>
			<listitem><para>The new requested CPU and RAM values must be within the constraints allowed by the hypervisor
				and the VM operating system.</para></listitem>
		</itemizedlist>
		<para>To configure this feature, use the following new global configuration variables:</para>
		<itemizedlist>
			<listitem><para>enable.dynamic.scale.vm: Set to True to enable the feature. By default, the feature is turned off.</para></listitem>
			<listitem><para>scale.retry: How many times to attempt the scaling operation. Default = 2.</para></listitem>
		</itemizedlist>
		<para>To modify the CPU and/or RAM capacity of a virtual machine, 
			you need to change
			the compute offering of the VM to a new compute offering that has the
			desired CPU and RAM values. You can use the same steps
			described above in <xref linkend="changing-service-offering-for-vm"/>, but skip the step where you
			stop the virtual machine. Of course, you might have to create a new compute offering first.</para>
		<para>When you submit a dynamic scaling request,
			the resources will be scaled up on the current host if possible.
			If the host does not have enough resources, the VM will be live migrated
			to another host in the same cluster.
			If there is no host in the cluster that can fulfill the requested level of CPU and RAM,
			the scaling operation will fail.
			The VM will continue to run as it was before.</para>
		<warning><para>&PRODUCT; will not check to be sure that the new CPU and RAM levels are compatible
			with the OS running on the VM.</para></warning>
	</section>
</section>

